<%- include('templates/header',{css:["css/index.css"]}) %>
<div class="bg-light d-flex justify-content-center align-items-center" style="min-height: 100vh;">
 <style>
    .profile-image {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border-radius: 50%;
      cursor: pointer;
      display: block;
      margin: 0 auto 1rem auto;
      border: 2px solid #001f3f;
    }

    #imageInput {
      display: none;
    }
  </style>
  <div class="card shadow-sm p-4" style="max-width: 500px; width: 100%;">
    

    <h2 class="text-center mb-3">Create Profile</h2>

    <form id="form" action="/submitProfile" method="POST" enctype="multipart/form-data">
      <div class="text-center mb-4">
        <label for="imageInput">
          <img src="<%=userData.image%>" class="profile-image" id="previewImage" alt="upload Image">
        </label>
        <input type="file" id="imageInput" name="profileImage" accept="image/*">
      </div>

      <!-- Personal Info -->
      <h2>Personal</h2>
      <label for="firstname">Name: </label><input value="<%=userData.name%>" placeholder="First Name" type="text" id="firstname" name="firstname" class="form-control mb-3" >
      <label for="lastname">Last name: </label><input value="<%=userData.lastname%>" placeholder="Last Name" type="text" id="lastname" name="lastname" class="form-control mb-3" >

      <label for="options">Status : </label><select value="<%=userData.user_type%>" name="user_type" id="options" class="form-select mb-3">
        <option value="student">Student</option>
        <option value="alumni">Alumni</option>
      </select>

      <label for="bio"></label><textarea placeholder="Bio*" type="textarea" id="bio" name="bio" class="form-control mb-3" >
         <%=userData.bio%>
      </textarea>
      <br><br>
      <!-- Education -->
      <h2>Education</h2>
      <section id="educationSection">

       <%- include('templates/profileEducationSet', { index: 0 }) %>

      </section>

      <button id="ed_add" class="btn  btn-success  btn-lg w-100">
        <i class="fas fa-add me-2"></i> Add
      </button>
      <br><br>
      <h2>Work Experience</h2>
      <section id="workExperienceSection">
        <%- include('templates/profileWorkExperienceSet', { index: 0 }) %>
      </section>

        <button id="work_add" class="btn btn-success btn-lg w-100">
          <i class="fas fa-add me-2"></i> Add
        </button>


      <label for="interest">Interests (comma seperated)</label><input value="<%= userData.interests.join(",")%>" placeholder="Fields of interest" type="text" id="interest" name="interests" class="form-control mb-3">
      <label for="skills">Skills (comma seperated)</label><input value="<%= userData.skills.join(",")%>" placeholder="Skills" type="text" id="skills" name="skills" class="form-control mb-3">
      <!-- Education -->
      <h2>Social Media</h2>
      <section id="socialMediaSet">

        <%- include('templates/profileSocialMediaSet', { index: 0 }) %>

      </section>

      <button id="social_add" class="btn  btn-success  btn-lg w-100">
        <i class="fas fa-add me-2"></i> Add
      </button>
      <br><br>
      <input id="education" name="education" style="display: none">
      <input id="workExp" name="workExp" style="display: none">
      <input id="media" name="media" style="display: none">

      <button id="submitBtn"  class="btn btn-primary w-100">Submit</button>

    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/scripts/fieldsetController.js"></script>


  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const input = document.getElementById("imageInput");
      const preview = document.getElementById("previewImage");

      input.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = () => {
            preview.src = reader.result;
          };
          reader.readAsDataURL(file);
        }
      });
    });
const form = document.getElementById("form");
    const eduController = new FieldsetListController('educationSection',<%-JSON.stringify( userData.education)%>);

    const workExpController = new FieldsetListController('workExperienceSection',<%-JSON.stringify( userData.work)%>);


    const socialMediaController = new FieldsetListController('socialMediaSet',<%-JSON.stringify( userData.media)%>);

     document.getElementById("ed_add").addEventListener("click", (event) => {
       event.preventDefault();
       eduController.addFieldset();
     });
    document.getElementById("work_add").addEventListener("click", (event) => {
      event.preventDefault();
      workExpController.addFieldset();
    });

    document.getElementById("social_add").addEventListener("click", (event) => {
      event.preventDefault();
      socialMediaController.addFieldset();
    });


    document.getElementById("submitBtn").addEventListener("click", (event) => {
      event.preventDefault();
      document.getElementById("education").setAttribute("value",JSON.stringify(eduController.getData()))
      document.getElementById("workExp").setAttribute("value",JSON.stringify(workExpController.getData()))
      document.getElementById("media").setAttribute("value",JSON.stringify(socialMediaController.getData()))
      form.submit();
    });
  </script>

</div>
<%- include('templates/footer', {currentPage:'account'}) %>